<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>景点信息</title>
    <link rel="stylesheet" href="./header.css">
    <link rel="stylesheet" href="./viewsearch.css">
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div id="header">
        <div id="spot" class="menu"><a href="./景点查询.html" target="_self">景点位置查询</a></div>
        <div id="comment" class="menu"><a href="" target="_self">景区信息查询</a></div>
        <div id="track" class="menu"><a href="" target="_self">足迹地图</a></div>
        <div id="bill" class="menu"><a href="" target="_self">出行账单</a></div>
        <div id="login"><a href="" target="_self">登录</a></div>
    </div>
    <div class="search">
        <input id="viewinput" type="text" placeholder="请输入景点名称">
        <button class="button" onclick="searchview()" name=searchview>搜索</button>
    </div>
    <div class="article">

        <div class="words">
            <h1 id="viewname"></h1>
            <h2 id="viewtype"></h2>
            <h2 id="viewcity"></h2>
            <h2 id="viewlocation"></h2>
            <h2 id="viewprice"></h2>
            <h2 id="viewbrief"></h2>
            <h2 id="viewscore"></h2>
            <h2 id="viewcompct"></h2>
            <div id="viewimag"></div>
            
        </div>
        <div id="comment-info">
            <div class="tach">评论区：</div>
            <div class="liuyan">
                <div class="part1">
                    <div class="cname">亲爱的小编</div>
                    <div class="cportrait"><img src="default.JPG" style='width:150px;height:150px'></div>
                    <div class="cdate">2020.7.22</div>
                    <div class="cscore">5</div>
                </div>
                <div class='part2'>
                    <div class="ccontent">快来看看其他人怎么评论吧！</div>
                </div>
            </div>
        </div>
        <div id="cview"></div>
    </div>

    <script src="./jquery-1.11.0.min.js"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script type="text/javascript"
        src="https://webapi.amap.com/maps?v=1.4.15&key=58c1e130c92ca38f524f575edf6b102d&plugin=AMap.Geocoder"></script>
    <script type="text/javascript">
        function searchview() {
            var spotName = document.getElementById("viewinput").value;
            var id;
            //第一次请求
            $.ajax({
                type: "GET",
                url: "http://basic.qicp.vip/spots",
                data: { spotname: spotName },
                dataType: "text",
                async: false,
                success: function (result) {
                    result = JSON.parse(result);
                    if (result.result == 1 || result.result == -1) {
                        alert(result.message);
                        document.getelementbyID("viewinput").value = " ";
                        return;
                    }
                    else {
                        id = result.id;
                        var name = result.word;
                        var eName = result.eName;
                        var type = result.type;
                        var districtName = result.districtName;
                        var price = result.price;
                        var alias = result.alias;
                        var address = result.address;
                        var imageUrl = result.imageUrl;
                        viewname.innerHTML = "景区名称：" + name + "&nbsp&nbsp&nbsp&nbsp景区英文名称：" + eName;
                        viewtype.innerHTML = "景区类型：" + type;
                        viewcity.innerHTML = "所属城市：" + districtName;
                        viewlocation.innerHTML = "景区地址：" + address;
                        viewprice.innerHTML = "门票价格：" + price;
                        viewbrief.innerHTML = "简介：" + alias;
                        var vimagepart = document.getElementById("viewimag");
                        var vimg = document.createElement('img');
                        vimg.setAttribute('src', imageUrl);
                        vimg.setAttribute('width', '300');
                        vimg.setAttribute('height', '192');
                        vimagepart.appendChild(vimg);
                    }
                },
                error: function (e) {
                    alert("上传失败，请检查网络或重试");
                }
            });
            //第二次请求
            $.ajax({
                type: "GET",
                url: "./spots/comments",
                data: { spotname: spotName, spotid: id },
                dataType: "text",
                success: function (result) {
                    result = JSON.parse(result);
                    if (result.result == 1 || result.result == -1) {
                        alert(result.message);
                        document.getelementbyID("viewinput").value = " ";
                        return;
                    }
                    else {
                        var cmtscore = result.data.cmtscore;
                        var recompct = result.data.recompct;
                        var comments = result.data.comments;
                        viewscore.innerHTML = "景区评分：" + cmtscore + "/5";
                        viewcompct.innerHTML = "景区推荐指数：" + recompct;
                        for (var i in comments) {
                            addComment("comment-info", i, comments[i]);
                        }
                    }
                },
                error: function (e) {
                    alert("上传失败，请检查网络或重试");
                }
            });
        }
        function addComment(obj, id, comment) {
            var uid = comment.uid;
            var userImage = comment.userImage;
            var title = comment.title;
            var content = comment.content;
            var date = comment.date;
            var score = comment.score;
            var bimgs = comment.bimgs;

            var demo = document.getElementById(obj);
            var div = document.createElement('div');
            div.setAttribute('class', 'liuyan');

            var intro = document.createElement('div');
            var infor = document.createElement('div');
            intro.setAttribute('class', 'part1');
            infor.setAttribute('class', 'part2');


            var div1 = document.createElement('div');
            var div2 = document.createElement('div');
            var div3 = document.createElement('div');
            var div4 = document.createElement('div');
            var div5 = document.createElement('div');
            div1.setAttribute('class', 'cname');
            div2.setAttribute('class', 'cportrait');
            div3.setAttribute('class', 'ccontent');
            div4.setAttribute('class', 'cdate');
            div5.setAttribute('class', 'cscore');
            intro.appendChild(div1);
            intro.appendChild(div2);
            infor.appendChild(div3);
            intro.appendChild(div4);
            intro.appendChild(div5);

            div1.innerHTML = uid;
            div3.innerHTML = content;
            div4.innerHTML = date;
            div5.innerHTML = "景区评分：" + score + "/5";

            var img = document.createElement('img');
            img.setAttribute('src', userImage);
            img.setAttribute('width', '150');
            img.setAttribute('height', '150');
            div2.appendChild(img);

            div.appendChild(intro);
            div.appendChild(infor);
            demo.appendChild(div);
            for (var j in bimgs) {
                addImage(bimgs[j]);
            }
        }

        function addImage(bimg) {
            var imagepart = document.getElementById("cview");
            var vimg = document.createElement('img');
            vimg.setAttribute('class', 'cimage');
            vimg.setAttribute('src', bimg);
            vimg.setAttribute('width', '150');
            vimg.setAttribute('height', '150');
            imagepart.appendChild(vimg);
        }
    </script>
</body>

</html>